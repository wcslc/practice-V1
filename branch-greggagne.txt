This branch comes from greggagne

I am proposing some pretty big changes, but they
should probably be handled through a pull request.
